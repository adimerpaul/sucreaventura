import{aA as E,g as O,r,l as H,c as f,o as d,w as o,a as t,Q as G,e as P,a4 as h,a3 as F,b as l,ap as B,f as T,Z as x,a2 as b,t as n,a0 as v,a1 as g,a5 as Z,a6 as j}from"./index-BlB52_SI.js";import{Q as Y}from"./QSelect-QTlV2Iv8.js";import{Q as J}from"./QForm-BTCHhETD.js";import{d as w,Q as k,a as u,b as c,c as K}from"./QList-DaEvEtxD.js";import{Q as W}from"./QBtnGroup-Ba2TKfxR.js";import{Q as X}from"./QMarkupTable-BACfkp8s.js";import{Q as ee}from"./QPage-DMNiky4X.js";import{h as q}from"./moment-C5S46NFB.js";import"./format-rzvYuvjd.js";const le={class:"row"},te={class:"col-6 col-md-2"},oe={class:"col-6 col-md-2"},ae={class:"col-6 col-md-2"},se={class:"col-6 col-md-2"},ne={class:"col-12 col-md-2 flex flex-center"},de={class:"col-12 col-md-12 q-pa-xs"},ie={key:0,class:"row"},re={class:"col-6 col-md-2 q-pa-xs"},ue={class:"text-weight-bold"},ce={class:"col-6 col-md-2 q-pa-xs"},pe={class:"text-weight-bold"},fe={class:"col-6 col-md-2 q-pa-xs"},me={class:"text-weight-bold"},_e={class:"col-6 col-md-2 q-pa-xs"},he={class:"text-weight-bold"},ve={class:"col-6 col-md-2 q-pa-xs"},xe={class:"text-weight-bold"},be={key:1,class:"text-green text-bold text-center"},ge={key:2,class:"text-red text-bold text-center"},we={style:{"font-size":"10px"}},ke={class:"text-right"},Fe={class:"text-right"},ye={key:0},Ce={key:1},Qe={class:"text-right"},Ae={class:"text-right"},Ve={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},$e={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},ze={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ne={__name:"Lista",setup(Be){const I=E(),{proxy:p}=O(),y=r(q().format("YYYY-MM-DD")),C=r(q().format("YYYY-MM-DD")),m=r([]),D=r([]),_=r(!1),Q=r(""),A=r([]),V=r(0),$=r("Todo"),U=r("Todo");H(()=>{z(),L()});function L(){A.value=[{id:0,name:"Todos"}],p.$axios.get("users").then(s=>{s.data.forEach(a=>{A.value.push(a)})}).catch(s=>{console.log(s)})}function M(){m.value=D.value.filter(s=>s.nombre.toLowerCase().includes(Q.value.toLowerCase()))}function N(s){const a=parseFloat(s.adelanto).toFixed(2),e=parseFloat(s.total).toFixed(2),i=parseFloat(s.total-s.adelanto).toFixed(2);p.$alert.dialogConfirm('<span style="color: blue;font-size: 20px;font-weight: bold">¿Desea confirmar la reserva? <br> </span>Total: '+e+"<br>Adelanto: "+a+'<br><span style="color: red;font-size: 20px;font-weight: bold">Saldo: '+i+" Bs</span>").onOk(()=>{_.value=!0,p.$axios.post("reservasConfirmar",{id:s.id}).then(S=>{p.$socket.emit("reservas"),I.push("/reservas")}).catch(S=>{p.$alert.error(S.response.data.message,"Error"),_.value=!1})})}function R(s){p.$alert.dialogAnular('<span style="color: red;font-size: 20px;font-weight: bold">¿Desea anular la reserva?</span>').onOk(()=>{_.value=!0,p.$axios.post("reservasAnular",{id:s}).then(a=>{p.$socket.emit("reservas"),z()}).catch(a=>{console.log(a)})})}function z(){_.value=!0,p.$axios.get("reservasAll",{params:{fechaInicio:y.value,fechaFin:C.value,user_id:V.value,tipo:$.value,agencia:U.value}}).then(s=>{m.value=s.data,D.value=s.data}).catch(s=>{console.log(s)}).finally(()=>{_.value=!1})}return(s,a)=>(d(),f(ee,{class:"q-pa-xs"},{default:o(()=>[t(G,{flat:"",bordered:""},{default:o(()=>[t(P,{class:"q-pa-xs"},{default:o(()=>[t(J,{onSubmit:z},{default:o(()=>[l("div",le,[l("div",te,[t(B,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),l("div",oe,[t(B,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),l("div",ae,[s.$store.user.role==="Admin"?(d(),f(Y,{key:0,modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=e=>V.value=e),label:"Usuario",outlined:"",dense:"",options:A.value,"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["modelValue","options"])):F("",!0)]),l("div",se,[s.$store.user.role==="Admin"?(d(),f(Y,{key:0,modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value=e),label:"Tipo",outlined:"",dense:"",options:["Todo","Adelanto","Confirmado"]},null,8,["modelValue"])):F("",!0)]),l("div",ne,[t(T,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:_.value},null,8,["loading"])]),l("div",de,[t(B,{modelValue:Q.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>Q.value=e),M],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])])])]),_:1}),s.$store.user.role==="Admin"?(d(),h("div",ie,[l("div",re,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[l("span",ue,n(m.value.length)+" reservas ",1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[5]||(a[5]=[v(" Cantidad ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),l("div",ce,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"orange","text-color":"white",icon:"attach_money"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[l("span",pe," Bs "+n(m.value.filter(e=>e.estado!=="Cancelado").reduce((e,i)=>e+parseFloat(i.adelanto),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[6]||(a[6]=[v(" Adelanto ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),l("div",fe,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"blue","text-color":"white",icon:"attach_money"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[l("span",me," Bs "+n(m.value.filter(e=>e.estado!=="Cancelado").reduce((e,i)=>e+parseFloat(i.saldo),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[7]||(a[7]=[v(" Saldo ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),l("div",_e,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[l("span",he," Bs "+n(m.value.filter(e=>e.estado!=="Cancelado").reduce((e,i)=>e+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[8]||(a[8]=[v(" Total ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),l("div",ve,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[l("span",xe," Bs "+n(m.value.filter(e=>e.estado==="Cancelado").reduce((e,i)=>e+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[9]||(a[9]=[v(" Anulados ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})])])):F("",!0),t(X,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[a[12]||(a[12]=l("thead",null,[l("tr",{class:"bg-green text-white"},[l("th",null,"Opcion"),l("th",null,"Nombre"),l("th",null,"Sala"),l("th",null,"Fecha"),l("th",null,"Hora"),l("th",null,"Total"),l("th",null,"Adelanto"),l("th",null,"Saldo"),l("th",null,"Estado"),l("th",null,"Observaciones"),l("th",null,"Adelanto"),l("th",null,"Confirmado"),l("th",null,"Agencia")])],-1)),l("tbody",null,[(d(!0),h(Z,null,j(m.value,e=>(d(),h("tr",{key:e.id},[l("td",null,[e.estado==="Reservado"?(d(),f(W,{key:0},{default:o(()=>[t(T,{dense:"",label:"Anular",color:"red",icon:"delete","no-caps":"",onClick:i=>R(e.id),size:"10px",loading:_.value},null,8,["onClick","loading"]),t(T,{dense:"",label:"Confirmar",color:"blue",icon:"check","no-caps":"",onClick:i=>N(e),size:"10px",loading:_.value},null,8,["onClick","loading"])]),_:2},1024)):e.estado==="Finalizado"?(d(),h("div",be," Finalizado ")):(d(),h("div",ge,[a[10]||(a[10]=v(" Anulado ")),a[11]||(a[11]=l("br",null,null,-1)),l("div",we,n(e.user_cancelado?.name),1)]))]),l("td",null,n(e.nombre),1),l("td",null,n(e.sala),1),l("td",null,n(s.$filters.dateDmYHis(e.fecha_creacion)),1),l("td",ke,n(e.horario),1),l("td",Fe,[e.estado!=="Finalizado"&&e.estado!=="Anulado"?(d(),h("span",ye,n(e.total),1)):s.$store.user.role==="Admin"?(d(),h("span",Ce,n(parseFloat(e.total).toFixed(2)),1)):F("",!0)]),l("td",Qe,n(e.adelanto),1),l("td",Ae,n(e.total-e.adelanto),1),l("td",null,[t(K,{color:e.color,dense:"",size:"10px"},{default:o(()=>[v(n(e.estado),1)]),_:2},1032,["color"])]),l("td",null,n(e.observaciones),1),l("td",null,[l("div",Ve,n(e.user?.username),1)]),l("td",null,[l("div",$e,n(e.user_confirmado?.username),1)]),l("td",null,[l("div",ze,n(e.agencia),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Ne as default};
