import{z as E,aB as U,g as M,r as i,l as z,c as x,o as u,w as r,a as o,Q,e as V,b as t,ap as g,f as b,a4 as s,a5 as C,a6 as $,t as c,a3 as w,h as I,aw as L}from"./index-C05ozP0x.js";import{Q as q}from"./QForm-Bi75cvdv.js";import{Q as j}from"./QMarkupTable-DK0wuBaQ.js";import{Q as D}from"./QSpace-CnhSba8s.js";import{Q as F}from"./QPage-8hAejBos.js";function G(){return E(U)}const K={class:"row"},O={class:"col-12 col-md-4"},T={class:"col-12 col-md-8 text-right"},H={key:0},J={key:0},R={key:1},oe={__name:"Producto",setup(W){const{proxy:m}=M(),k=i([]),_=i([]),y=i(""),d=i(!1),a=i({id:null,nombre:"",precio:"",stock:""}),h=G(),p=i(!1);z(()=>{v()});function P(){k.value=_.value.filter(n=>n.nombre.toLowerCase().includes(y.value.toLowerCase()))}function v(){m.$axios.get("/productos").then(n=>{k.value=n.data,_.value=n.data})}function S(){a.value={id:null,nombre:"",precio:"",stock:""},d.value=!0}function B(n){a.value={...n},d.value=!0}function N(){if(a.value.id){const n=_.value.find(l=>l.id===a.value.id);if(n&&parseInt(a.value.stock)<n.stock){h.notify({type:"warning",message:"No se puede reducir el stock. Solo se permite aumentarlo.",position:"top"});return}m.$axios.put(`/productos/${a.value.id}`,a.value).then(v)}else m.$axios.post("/productos",a.value).then(v);d.value=!1}function A(n){h.dialog({title:"Eliminar producto",message:"¿Está seguro de eliminar este producto?",persistent:!0,ok:{label:"Sí",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{p.value=!0,m.$axios.delete(`/productos/${n}`).then(v).catch(l=>{m.$alert.error(l.response.data.message,"Error")}).finally(()=>{p.value=!1})})}return(n,l)=>(u(),x(F,{class:"q-pa-xs"},{default:r(()=>[o(Q,{flat:"",bordered:""},{default:r(()=>[o(V,{class:"q-pa-xs"},{default:r(()=>[o(q,{onSubmit:v},{default:r(()=>[t("div",K,[t("div",O,[o(g,{modelValue:y.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>y.value=e),P],label:"Buscar producto",outlined:"",dense:""},null,8,["modelValue"])]),t("div",T,[o(b,{label:"Agregar",color:"green",icon:"add_circle_outline","no-caps":"",onClick:S,loading:p.value},null,8,["loading"])])])]),_:1}),o(j,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[l[6]||(l[6]=t("thead",null,[t("tr",{class:"text-bold bg-primary text-white"},[t("th",null,"Nombre"),t("th",null,"Combo"),t("th",null,"Precio"),t("th",null,"Stock"),t("th",null,"Agencia"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(u(!0),s(C,null,$(k.value,e=>(u(),s("tr",{key:e.id},[t("td",null,c(e.nombre),1),t("td",null,[e.producto_combo.length?(u(),s("ul",H,[(u(!0),s(C,null,$(e.producto_combo,f=>(u(),s("li",{key:f.id},c(f.cantidad)+" x "+c(f.producto_hijo?.nombre),1))),128))])):w("",!0)]),t("td",null,c(e.precio),1),t("td",null,c(e.stock),1),t("td",null,c(e.agencia),1),t("td",null,[o(b,{icon:"edit",color:"blue",class:"q-mr-md",size:"10px",dense:"",onClick:f=>B(e),loading:p.value},null,8,["onClick","loading"]),n.$store.user.role==="Admin"?(u(),x(b,{key:0,icon:"delete",color:"red",size:"10px",dense:"",onClick:f=>A(e.id),loading:p.value},null,8,["onClick","loading"])):w("",!0)])]))),128))])]),_:1})]),_:1})]),_:1}),o(I,{modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value=e)},{default:r(()=>[o(Q,null,{default:r(()=>[o(V,{class:"text-h6 q-pb-none row items-center"},{default:r(()=>[a.value.id?(u(),s("div",J,"Editar producto")):(u(),s("div",R,"Agregar producto")),o(D),o(b,{flat:"",dense:"",icon:"close",onClick:l[1]||(l[1]=e=>d.value=!1)})]),_:1}),o(V,null,{default:r(()=>[o(q,{onSubmit:L(N,["prevent"])},{default:r(()=>[o(g,{modelValue:a.value.nombre,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.nombre=e),label:"Nombre",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(g,{modelValue:a.value.precio,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.precio=e),label:"Precio",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(g,{modelValue:a.value.stock,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.stock=e),label:"Stock",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(b,{label:"Guardar",color:"primary",type:"submit",class:"q-mt-md"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{oe as default};
