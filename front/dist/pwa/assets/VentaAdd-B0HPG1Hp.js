import{aA as E,g as U,r as u,l as F,x as M,c as k,o as r,w as o,b as a,a as t,f as v,Q as _,e as g,ap as w,b1 as T,u as O,a4 as f,a5 as C,a6 as y,Z as j,a0 as x,t as i,a3 as Z,a1 as G,ao as H,h as J,aw as K}from"./index-BlB52_SI.js";import{d as W,Q as X,a as z,b as S,c as Y}from"./QList-DaEvEtxD.js";import{Q as P}from"./QSpace-CmTFgcVg.js";import{Q as ee}from"./QMarkupTable-BACfkp8s.js";import{Q as le}from"./QForm-BTCHhETD.js";import{Q as ae}from"./QPage-DMNiky4X.js";const te={class:"row"},oe={class:"col-12"},ne={class:"col-12 col-md-7"},se={key:0},re={class:"col-12 col-md-5"},de={class:"div"},ue={class:"text-h6 row items-center"},ie={class:"text-bold"},ge={__name:"VentaAdd",setup(ce){const I=E(),{proxy:c}=U(),b=u({nombre:"",fecha:new Date().toISOString().slice(0,10)}),Q=u([]),$=u([]),s=u([]);let p=u("");const V=u(!1),m=u(!1);F(()=>{q()});function q(){c.$axios.get("/productos").then(n=>{Q.value=n.data,$.value=n.data})}const B=M(()=>s.value.reduce((n,e)=>n+e.cantidadVenta*e.precioVenta,0).toFixed(2));function A(){Q.value=$.value.filter(n=>n.nombre.toLowerCase().includes(p.value.toLowerCase()))}function D(n){const e=s.value.find(l=>l.id===n.id);e?e.cantidadVenta++:s.value.push({...n,cantidadVenta:1,precioVenta:n.precio})}function L(n){s.value.splice(n,1)}function N(){if(s.value.length===0){c.$alert.error("El carrito está vacío","Error");return}V.value=!0,b.value={nombre:"SN"}}function R(){if(s.value.length===0){c.$alert.error("El carrito está vacío");return}m.value=!0,c.$axios.post("/ventas",{...b.value,total:B.value,productos:s.value}).then(async()=>{s.value=[],b.value={nombre:"",fecha:new Date().toISOString().slice(0,10)},V.value=!1,c.$alert.success("Venta realizada con éxito","Éxito"),I.push("/ventas"),p.value=""}).catch(n=>{c.$alert.error(n.response.data.message,"Error")}).finally(()=>{m.value=!1})}return(n,e)=>(r(),k(ae,{class:"q-pa-xs"},{default:o(()=>[a("div",te,[a("div",oe,[t(v,{label:"Atras",color:"primary",onClick:e[0]||(e[0]=l=>n.$router.push("/ventas")),"no-caps":"",icon:"arrow_back"})]),a("div",ne,[t(_,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[t(g,null,{default:o(()=>[t(w,{modelValue:O(p),"onUpdate:modelValue":[e[1]||(e[1]=l=>T(p)?p.value=l:p=l),A],label:"Buscar producto",outlined:"",dense:"",debounce:"300"},null,8,["modelValue"]),t(W,{bordered:"",padding:"",dense:""},{default:o(()=>[(r(!0),f(C,null,y(Q.value,l=>(r(),f(C,{key:l.id},[j((r(),k(X,{clickable:"",onClick:d=>D(l)},{default:o(()=>[t(z,null,{default:o(()=>[t(S,null,{default:o(()=>[x(i(l.nombre),1)]),_:2},1024),t(S,{caption:""},{default:o(()=>[l.producto_combo.length>0?(r(),f("span",se,[(r(!0),f(C,null,y(l.producto_combo,d=>(r(),k(Y,{key:d.id,label:d.cantidad+" "+d.producto_hijo.nombre,dense:""},null,8,["label"]))),128))])):Z("",!0),x(" "+i(l.precio)+" Bs ",1)]),_:2},1024)]),_:2},1024),t(z,{side:""},{default:o(()=>[t(S,{caption:"",class:""},{default:o(()=>[e[6]||(e[6]=x(" Cant ")),e[7]||(e[7]=a("br",null,null,-1)),x(" "+i(l.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[G]]),t(H,{spaced:"",inset:""})],64))),128))]),_:1})]),_:1})]),_:1})]),a("div",re,[t(_,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[t(g,null,{default:o(()=>[a("div",de,[a("div",ue,[e[8]||(e[8]=a("div",null,"Carrito",-1)),t(P),t(v,{icon:"delete",color:"red",dense:"",onClick:e[2]||(e[2]=l=>s.value=[]),loading:m.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),e[9]||(e[9]=a("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),t(ee,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[e[12]||(e[12]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Producto"),a("th",null,"Cantidad"),a("th",null,"Precio"),a("th",null,"Subtotal"),a("th",null,"Acciones")])],-1)),a("tbody",null,[(r(!0),f(C,null,y(s.value,(l,d)=>(r(),f("tr",{key:d},[a("td",null,i(l.nombre),1),a("td",null,[t(w,{modelValue:l.cantidadVenta,"onUpdate:modelValue":h=>l.cantidadVenta=h,modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),a("td",null,i(l.precio)+" Bs ",1),a("td",null,i((l.cantidadVenta*l.precioVenta).toFixed(2))+" Bs",1),a("td",null,[t(v,{icon:"delete",color:"red",dense:"",onClick:h=>L(d),loading:m.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),a("tfoot",null,[a("tr",null,[e[10]||(e[10]=a("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),a("td",ie,i(B.value)+" Bs",1),e[11]||(e[11]=a("td",null,null,-1))])])]),_:1}),t(v,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:N,loading:m.value},null,8,["loading"])]),_:1})]),_:1})])]),t(J,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l)},{default:o(()=>[t(_,{flat:"",bordered:""},{default:o(()=>[t(g,{class:"q-pb-none row items-center"},{default:o(()=>[e[13]||(e[13]=a("div",{class:"text-bold"}," Realizar Venta ",-1)),t(P),t(v,{flat:"",dense:"",round:"",icon:"close",onClick:e[3]||(e[3]=l=>V.value=!1)})]),_:1}),t(g,null,{default:o(()=>[t(le,{onSubmit:K(R,["prevent"])},{default:o(()=>[t(w,{modelValue:b.value.nombre,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value.nombre=l),label:"Nombre Cliente",outlined:"",dense:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),t(v,{label:"Realizar Venta",color:"positive",type:"submit","no-caps":"",loading:m.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ge as default};
